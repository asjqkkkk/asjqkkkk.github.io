<!DOCTYPE html>
<html lang="zh-Hans">





<head>
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/img/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="çŸ¥æƒ‘é¡¿æ–­å¦‚ç¢çŸ³ï¼Œæ€æƒ‘éš¾æ–­å¦‚è—•ä¸">
    <meta name="author" content="Old Chen">
    <meta name="keywords" content="Android">
    <title>Room Databaseå…¥é—¨æŒ‡å— ~ è€æ™¨å­ã®åšå®¢</title>
    <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css?v=5.7.2">
    <link rel="stylesheet" href="/lib/mdbootstrap/css/bootstrap.min.css?v=4.3.1">
    <link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css?v=4.8.7">
    <link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css">
    <link rel="stylesheet" href="/lib/nprogress/nprogress.css?v=0.2.0">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">
    
        <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css">
    
    <link rel="stylesheet" href="/css/main.css">

    
</head>


<body>
<header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
<div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>è€æ™¨å­ã®åšå®¢</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto text-center">
            
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/archives/">Archives</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/categories/">Categories</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/tags/">Tags</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/about/">About</a>
            </li>
            
            
                <li class="nav-item" id="search-btn">
                    <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
                </li>
            
        </ul>
    </div>
</div>


</nav>
    <div class="view intro-2"
         style="background: url('/img/post.png')no-repeat center center;background-size: cover;">
        <div class="full-bg-img">
            <div class="mask rgba-black-light flex-center">
                <div class="container text-center white-text wow fadeInUp">
                    <span class="h2" id="subtitle">
                        
                    </span>
                    
                        <br>
                        <p>Tuesday, October 30th 2018, 7:12 pm</p>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<main>
    
        

<div class="container-fluid">
    <div class="row">
        <div class="d-none d-lg-block col-lg-2"></div>
            <div class="col-lg-8 nopadding-md">
                <div class="py-5 z-depth-3 board">
                    <div class="post-content mx-auto">
                        <div class="markdown-body">
                            <p>è¯´åˆ°Androidç«¯æœ‰å“ªäº›å¯ä»¥ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¤§å®¶é¦–å…ˆæƒ³åˆ°çš„è‡ªç„¶æ˜¯SQLiteè¿™ç§å¸¦æœ‰å®˜æ–¹å±æ€§åŠ æŒçš„è½»å‹çš„æ•°æ®åº“ã€‚</p>
<p>ä¸è¿‡å¯¹äºåƒæˆ‘è¿™ç§åŸºæœ¬ä¸Šæ²¡æœ‰æ¥è§¦è¿‡SQLæ•°æ®åº“è¯­è¨€ç¼–å†™çš„äººæ¥è¯´ï¼Œè¦é€šè¿‡å»å†™éš¾ä»¥æŸ¥é”™ä¸”åˆæ¯«ä¸ç†Ÿæ‚‰çš„æ•°æ®åº“ä»£ç æ‰èƒ½æ“ä½œæ•°æ®åº“çš„è¯ï¼Œé‚£å°±å¤ªä»¤äººå¤´å¤§äº†ã€‚</p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/001-001.jpg" alt="image"></p>
<p>äºæ˜¯ä¹ï¼Œä¾¿äºAndroidå¼€å‘è€…æ“ä½œæ•°æ®åº“çš„æ¡†æ¶ä¹Ÿå°±å¤šäº†èµ·æ¥ï¼Œå…¶ä¸­äººæ°”è¾ƒé«˜çš„å°±æœ‰GreenDaoã€Realmï¼ŒObjectBoxç­‰ï¼Œè€ŒRoomåˆ™æ˜¯è°·æ­Œå®˜æ–¹ååˆ†æ¨èçš„ï¼Œå¯ä»¥ä»£æ›¿SQliteçš„ä¸äºŒä¹‹é€‰ã€‚<br><a id="more"></a><br>æœ¬ç¯‡çš„ä¸»è¦ä»‹ç»å¯¹è±¡ä¹Ÿæ˜¯Roomæ•°æ®åº“ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œè¿˜å¾—ç®€å•ä»‹ç»ä¸€ä¸‹ä¸Šé¢æåˆ°è¿‡çš„å…¶ä»–å‡ ä½ï¼ŒåŒæ—¶åšä¸ªå°å°çš„å¯¹æ¯”ã€‚</p>
<h1 id="ä¸€ã€ä»‹ç»ä¸æ¯”è¾ƒ"><a href="#ä¸€ã€ä»‹ç»ä¸æ¯”è¾ƒ" class="headerlink" title="ä¸€ã€ä»‹ç»ä¸æ¯”è¾ƒ"></a>ä¸€ã€ä»‹ç»ä¸æ¯”è¾ƒ</h1><p>ç”±äºæˆ‘ç”¨è¿‡çš„æ•°æ®åº“æ¡†æ¶å¹¶ä¸å¤šï¼Œæ‰€ä»¥å¯¹äºç”¨è¿‡çš„å¯ä»¥è¯´ä¸€ä¸‹æ„Ÿå—ï¼Œæ²¡ç”¨è¿‡çš„å°±ç®€å•å¸¦è¿‡äº†ã€‚</p>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><h3 id="GreenDao-å’Œ-ObjectBox"><a href="#GreenDao-å’Œ-ObjectBox" class="headerlink" title="GreenDao å’Œ ObjectBox"></a>GreenDao å’Œ ObjectBox</h3><p>åœ¨è¿™äº›æ•°æ®åº“ä¸­ï¼Œ <strong>GreenDao</strong> ç®—æ˜¯æ—©é—»å…¶åï¼Œä¸è¿‡ä¸€ç›´æ²¡æœ‰ç”¨è¿‡ï¼Œåæ¥å®ƒçš„ä½œè€…åˆå‡ºäº†ä¸ª <strong>ObjectBox</strong> ï¼Œè€Œä¸”ä½ å¯ä»¥åœ¨ <a href="https://github.com/greenrobot/greenDAO" target="_blank" rel="noopener"><strong>GreenDao</strong>çš„GitHubé¡µé¢</a> æ‰¾åˆ°æ¨èä½¿ç”¨ <strong>ObjectBox</strong> çš„ <a href="https://objectbox.io/" target="_blank" rel="noopener">ObjectBoxåœ°å€</a> .</p>
<h3 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a>Realm</h3><p>æˆ‘çœŸæ­£ä½¿ç”¨è¿‡çš„è¿˜åªæœ‰ <strong>Realm</strong> æ•°æ®åº“ï¼Œè¿™é‡Œè¦æä¸€ä¸‹ï¼Œ<strong>Realm</strong> æ•°æ®åº“å¯¹äºä¸­å›½çš„å¼€å‘è€…éå¸¸çš„å‹å¥½ï¼Œå°±åƒå¤§åé¼é¼çš„Glideä¸€æ ·ï¼Œ <strong>Realm</strong> ä¹Ÿæœ‰ä¸­æ–‡çš„ä»‹ç»æ–‡æ¡£ï¼Œæ–‡æ¡£åœ°å€åœ¨æ­¤ï¼š<br><a href="https://realm.io/cn/docs/java/latest/" target="_blank" rel="noopener">å¼€å§‹ä½¿ç”¨Realm</a><br>è™½ç„¶è¿™ä»½æ–‡æ¡£å¯¹åº”çš„ç‰ˆæœ¬ä¸æ˜¯æœ€æ–°çš„. ä¸è¿‡å¯¹äºåˆæ¬¡æ¥è§¦ <strong>Realm</strong> äººæ¥è¯´ï¼Œçœ‹è¿™ä»½æ–‡æ¡£å°±å¯ä»¥ä¸Šæ‰‹äº†</p>
<p>æœ€å¼€å§‹ä½¿ç”¨Realmçš„æ—¶å€™ä¹Ÿæ˜¯ç¢°è¿‡ä¸å°‘å‘ï¼Œä¸è¿‡æœ€ä¸»è¦çš„æ˜¯æ‰€æœ‰æ•°æ®åº“å¯¹è±¡éœ€è¦ç»§æ‰¿ <strong>RealmObject</strong> è¿™ä¸ªç±»(ä¹Ÿå¯ä»¥é€šè¿‡æ¥å£å®ç°)ï¼Œè¿™æ ·å¯¹é¡¹ç›®å·²æœ‰çš„æ•°æ®ç»“æ„ä¸å¤ªå‹å¥½ï¼ŒåŒæ—¶æˆ‘è¿˜å‘ç°ç»§æ‰¿äº† <strong>RealmObject</strong> çš„å¯¹è±¡å¹¶ä¸èƒ½ä¸ <strong>Gson</strong> å®Œç¾ç»“åˆï¼Œå¦‚æœéœ€è¦è½¬æ¢çš„è¯ï¼Œè¿˜æ˜¯å¾—è´¹ä¸€ç•ªå‘¨æŠ˜çš„ã€‚<br>ç§ç§åŸå› ï¼Œå¯¼è‡´æˆ‘æœ€åä»é¡¹ç›®ä¸­æŠ½å»äº†Realmè¿™ä¸ªæ•°æ®åº“.</p>
<h3 id="Room"><a href="#Room" class="headerlink" title="Room"></a>Room</h3><p>ä¸ Realm åˆ†æ‰‹åçš„æ—¥å­é‡Œï¼Œæˆ‘å¹¶æ²¡æœ‰æ”¾å¼ƒå¯¹æ–°çš„æ•°æ®åº“çš„å¯»æ‰¾ï¼Œåæ¥åœ¨æµè§ˆ Googleå®˜æ–¹æ–‡æ¡£çš„æ—¶å€™æ‰å‘ç°äº† <strong>Room</strong> è¿™ä¸ªæ–°çš„æ•°æ®åº“ï¼Œç»è¿‡æˆ‘ä¸€ç•ªä½¿ç”¨åï¼Œå°±å†³å®šæ˜¯å®ƒäº†ï¼<br><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/001-002.jpg" alt="image"></p>
<h2 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h2><p>å› ä¸ºæ‡’æƒ°çš„åŸå› ï¼Œæˆ‘å¹¶æ²¡æœ‰åšè¿‡æ·±å…¥çš„æµ‹è¯•ï¼Œä¸‹é¢ä¼šç»™å‡ºä»ç½‘ä¸Šæ‰¾åˆ°çš„å…³äºè¿™äº›æ•°æ®åº“çš„å¯¹æ¯”ï¼ŒåŸæ–‡åœ°å€å¦‚ä¸‹ï¼š</p>
<p><a href="https://notes.devlabs.bg/realm-objectbox-or-room-which-one-is-for-you-3a552234fd6e" target="_blank" rel="noopener"><strong>Realm, ObjectBox or Room. Which one is for you?</strong></a></p>
<p>ç„¶åæ˜¯æ•°æ®é‡è¾¾åˆ° <strong>100k/10k</strong> çš„æ—¶å€™ï¼Œè¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œæ¶ˆè€—çš„æ—¶é—´å¯¹æ¯”ï¼š</p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/001.jpeg" alt="image"><br><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/002.jpeg" alt="image"></p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/003.jpeg" alt="image"><br><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/004.jpeg" alt="image"></p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/005.jpeg" alt="image"><br><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/006.jpeg" alt="image"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å„ä¸ªæ–¹é¢ï¼Œç»Ÿç»Ÿéƒ½æ˜¯ <strong>ObjectBox</strong> å‚²è§†ç¾¤é›„ã€‚<br>é‚£è¿™ç¯‡æ–‡ç« ä¸ºä»€ä¹ˆè¿˜æ˜¯è¦å†™ä»‹ç»å…³äº <strong>Room Database</strong> å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆæ˜¯å®˜æ–¹BuffåŠ æŒï¼Œå’Œä»‹ç»æ–‡æ¡£é‡Œçš„ä¸€å¥è¯ï¼š<br><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/007.png" alt="image"><br><a href="https://developer.android.google.cn/training/data-storage/room/" target="_blank" rel="noopener">è¿™é‡Œæ˜¯Roomçš„å®˜æ–¹ä»‹ç»æ–‡æ¡£åœ°å€</a></p>
<p>å¤§è‡´æ„æ€å°±æ˜¯ï¼š<strong>æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ ç”¨Roonå»ä»£æ›¿SQLiteï¼Œä¸è¿‡å¦‚æœä½ æ˜¯ä¸ªé“å¤´å¨ƒéå¾—ç”¨SQLiteï¼Œé‚£æˆ‘ä»¬ä¹Ÿæ²¡æœ‰åŠæ³•ã€‚</strong></p>
<p>é™¤äº†ä¸Šé¢è¿™æ®µè¯ï¼Œè¿˜æœ‰ä¸€ç‚¹ä¹Ÿå¯ä»¥ä½œä¸ºé€‰æ‹©Roomçš„åŸå› ï¼Œå°±æ˜¯å¯¹äºApkçš„â€œå¢é‡â€æ˜¯å¤šå°‘ã€‚æ®åˆ«äººçš„æµ‹è¯•</p>
<blockquote>
<p>ObjectBoxå’ŒRealmåˆ†åˆ«å ç”¨1-1.5MBå’Œ3-4MBï¼ˆå¤§å°å–å†³äºæ‰‹æœºæ¶æ„ï¼‰ï¼Œè€Œä½œä¸ºSQLå°è£…çš„Roomåªå ç”¨å¤§çº¦50KBã€‚åœ¨æ–¹æ³•çš„å¢é‡ä¸Šï¼ŒRoomåªæœ‰300å¤šä¸ªï¼ŒObjectBoxå’ŒRealmåˆ™åˆ†åˆ«æ˜¯1300å’Œ2000ä¸ª</p>
</blockquote>
<p>å½“ç„¶ï¼Œå¦‚æœä½ çš„æ•°æ®é‡å¾ˆå¤§çš„è¯ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯ <strong>ObjectBox</strong> æ›´åŠ é€‚åˆä½ ï¼Œå› ä¸ºå°±ä»ä¸Šé¢çš„æ“ä½œæ•°æ®å¯¹æ¯”æ¥çœ‹ï¼Œ <strong>ObjectBox</strong> å¤ªç‰›é€¼äº†ï¼æˆ‘ä»¥åè‚¯å®šä¹Ÿä¼šèŠ±æ—¶é—´å»å¯¹ <strong>ObjectBox</strong> åšä¸€ç•ªç ”ç©¶ï¼Œä¸è¿‡ç›®å‰è¿˜æ˜¯å…ˆæ¥ä»‹ç»ä»‹ç» <strong>Room</strong> å§ã€‚</p>
<h1 id="äºŒã€Roomçš„ç»“æ„"><a href="#äºŒã€Roomçš„ç»“æ„" class="headerlink" title="äºŒã€Roomçš„ç»“æ„"></a>äºŒã€Roomçš„ç»“æ„</h1><p>ä¹‹å‰æœ‰è¯´è¿‡ï¼Œ<strong>Room</strong> æ˜¯å¯ä»¥ä»£æ›¿ <strong>SQLite</strong> çš„ï¼Œä¸è¿‡æˆ‘è§‰å¾—Googleæ¨å‡ºå®ƒæ›´å¤šçš„æ˜¯ä¸ºäº†æ­é… <strong>DataBinding</strong> ä½¿ç”¨ï¼Œå¦‚æœä½ å¯¹äº <strong>DataBinding</strong> ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯ä»¥çœ‹ä¸€çœ‹æˆ‘å‰é¢çš„å…³äº <strong>DataBinding</strong> çš„æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚ä¸‹é¢å°±å¼€å§‹è¯´è¯´ <strong>Room</strong> çš„ç»“æ„ã€‚</p>
<p>Roomä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ <strong>Database</strong>(æ•°æ®åº“) ã€<strong>Entity</strong>(å®ä½“) ã€<strong>DAO</strong>(æ•°æ®è®¿é—®å¯¹è±¡) </p>
<h2 id="Database-æ•°æ®åº“"><a href="#Database-æ•°æ®åº“" class="headerlink" title="Database(æ•°æ®åº“)"></a>Database(æ•°æ®åº“)</h2><p>æ•°æ®åº“æŒ‡çš„å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“å¯¹è±¡ï¼Œå®ƒç»§æ‰¿äº <strong>RoomDataBase</strong> è¿™ä¸ªç±»ï¼Œå¹¶ä¸”éœ€è¦ç”¨ <strong>@DataBase</strong> æ³¨è§£ï¼Œè·å–è¿™ä¸ªæ•°æ®åº“å¯¹è±¡çš„æ–¹æ³•æ˜¯é€šè¿‡è°ƒç”¨ <strong>Room.databaseBuilder()</strong> æˆ–è€… <strong>Room.inMemoryDatabaseBuilder()</strong> ï¼Œåè€…è¡¨ç¤ºåœ¨å†…å­˜ä¸­å­˜å‚¨æ•°æ®ï¼Œå¦‚æœç¨‹åºç»“æŸäº†æ•°æ®ä¹Ÿå°±æ¶ˆå¤±äº†ï¼Œæ‰€ä»¥ä¸€èˆ¬è¿˜æ˜¯ä½¿ç”¨å‰è€…ã€‚</p>
<h2 id="Entity-å®ä½“"><a href="#Entity-å®ä½“" class="headerlink" title="Entity(å®ä½“)"></a>Entity(å®ä½“)</h2><p>å®ä½“çš„æ¦‚å¿µå°±æ¯”è¾ƒç®€å•äº†ï¼Œå°±ç±»ä¼¼äºMySQLæ•°æ®åº“é‡Œé¢çš„è¡¨ï¼Œä¸€ä¸ªå®ä½“ç±»ç›¸å½“äºä¸€ä¸ªè¡¨ï¼Œè€Œä¸€ä¸ªå®ä½“ç±»æœ‰å¤šä¸ªå±æ€§ï¼Œå°±ç›¸å½“äºè¡¨çš„å¤šä¸ªå­—æ®µï¼Œè¿™ä¸ªçœ‹ä¸€çœ‹æ¥ä¸‹æ¥å…³äº <strong>Entity</strong> çš„ä»£ç ä¾¿ä¸€ç›®äº†ç„¶ã€‚</p>
<h2 id="DAO"><a href="#DAO" class="headerlink" title="DAO"></a>DAO</h2><p>å…³äº <strong>DAO</strong> ï¼ŒæŠ½è±¡çš„æ¦‚å¿µå°±è¡¨ç¤º<strong>æ•°æ®è®¿é—®å¯¹è±¡</strong>ï¼Œåœ¨è¿™é‡Œç®€å•çš„è§£é‡Šä¸€ä¸‹å°±æ˜¯æ•°æ®æ“ä½œæ¥å£ï¼Œå¯ä»¥é€šè¿‡ç¼–å†™ <strong>DAOæ¥å£</strong> å¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰ä¸€ç³»åˆ—æ“ä½œã€‚  </p>
<blockquote>
<p>PS:è¿™äº›æ¥å£å¯ä»¥æ”¯æŒRxJavaçš„å“¦ï¼</p>
</blockquote>
<p>ä¸‹é¢æ˜¯å›¾ç‰‡è¯´æ˜ï¼š</p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/009.png" alt="image"></p>
<h1 id="ä¸‰ã€å¼€å§‹ä½¿ç”¨"><a href="#ä¸‰ã€å¼€å§‹ä½¿ç”¨" class="headerlink" title="ä¸‰ã€å¼€å§‹ä½¿ç”¨"></a>ä¸‰ã€å¼€å§‹ä½¿ç”¨</h1><p>åœ¨ <strong>Room</strong> çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ˜¯é‡åˆ°ä¸€äº›å‘çš„ï¼Œä¸è¿‡éƒ½å·²ç»è§£å†³æ‰äº†ã€‚å¦‚æœä½ ä¹Ÿé‡åˆ°è¿‡æŸäº›é—®é¢˜ï¼Œä¸å¦¨å¯¹ç…§ä¸€ä¸‹æˆ‘çš„æ¥å…¥æµç¨‹ï¼Œè¯´ä¸å®šå°±æ‰¾åˆ°äº†é—®é¢˜æ‰€åœ¨ã€‚</p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/008.png" alt="image"></p>
<h2 id="æ¥å…¥Gradle"><a href="#æ¥å…¥Gradle" class="headerlink" title="æ¥å…¥Gradle"></a>æ¥å…¥Gradle</h2><p>ä¸ºäº†é¿å…ä¹‹åçš„å•å…ƒæµ‹è¯•å‡ºç° <font color="#DC143C">java.lang.RuntimeException: Method e in android.util.Log not mocked. See <a href="http://g.co/androidstudio/not-mocked" target="_blank" rel="noopener">http://g.co/androidstudio/not-mocked</a> for details.</font> çš„é”™è¯¯ï¼Œé™¤äº† <strong>Room</strong> ç›¸å…³çš„ä¾èµ–éœ€è¦æ·»åŠ å¤–ï¼Œè¿™é‡Œè¿˜éœ€è¦å†å¼•ç”¨ä¸€ä¸‹ <strong>robolectricå•å…ƒæµ‹è¯•åº“</strong> è§£å†³é—®é¢˜ï¼</p>
<pre><code>    //roomæ•°æ®åº“
    def room_version = &quot;1.1.1&quot;
    implementation &quot;android.arch.persistence.room:runtime:$room_version&quot;
    annotationProcessor &quot;android.arch.persistence.room:compiler:$room_version&quot;
    kapt &quot;android.arch.persistence.room:compiler:$room_version&quot;      // ç”±äºè¦ä½¿ç”¨Kotlin,è¿™é‡Œä½¿ç”¨äº†kapt
    implementation &quot;android.arch.persistence.room:rxjava2:$room_version&quot;        //ä¹‹åä¼šç”¨åˆ°rxjavaï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå¯ä»¥æœ‰
//    implementation &quot;android.arch.persistence.room:guava:$room_version&quot;        //ç”±äºæˆ‘ä»¬ä¸ç”¨guavaï¼Œè¿™è¡Œæ³¨é‡Šæ‰
    testImplementation &quot;android.arch.persistence.room:testing:$room_version&quot; 

    //robolectricæµ‹è¯•
    testImplementation &#39;org.robolectric:shadows-multidex:3.8&#39;
    testImplementation &quot;org.robolectric:robolectric:3.8&quot;
    //è¿™æ ·å°±èµ„ç“·å•å…ƒæµ‹è¯•å’¯ï¼
</code></pre><p>å’Œæˆ‘ä¸€æ ·ä½¿ç”¨Kotlinçš„ç«¥é‹åˆ«å¿˜äº†ä¸‹é¢è¿™è¡Œï¼š</p>
<pre><code>apply plugin: &#39;kotlin-kapt&#39;
</code></pre><p>è¿˜æœ‰ï¼Œéœ€è¦åšå¦‚ä¸‹æ›´æ”¹ï¼š</p>
<pre><code>    androidTestImplementation &#39;com.android.support.test:runner:1.0.2&#39;

    //æ›´æ”¹ä¸º
    implementation &#39;com.android.support.test:runner:1.0.2&#39;

</code></pre><p>è¿™ç‚¹ä¸€å®šè¦æ”¹å“¦ï¼ä¸ç„¶ä¼šå‡ºç°ä¸€äº›è«åå…¶å¦™çš„é—®é¢˜</p>
<p>ç›¸å…³åº“çš„ä¾èµ–æˆåŠŸæ·»åŠ åå°±å¯ä»¥å¼€å§‹åŠ¨æ‰‹äº†ï¼</p>
<h2 id="åˆ›å»º-Entityã€Dao-ä¸-DataBase"><a href="#åˆ›å»º-Entityã€Dao-ä¸-DataBase" class="headerlink" title="åˆ›å»º Entityã€Dao ä¸ DataBase"></a>åˆ›å»º Entityã€Dao ä¸ DataBase</h2><h3 id="åˆ›å»ºEntity"><a href="#åˆ›å»ºEntity" class="headerlink" title="åˆ›å»ºEntity"></a>åˆ›å»ºEntity</h3><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª <strong>Entity</strong> å¯¹è±¡ï¼Œå°±æŠŠå®ƒå‘½åä¸º <strong>Book</strong> å§</p>
<pre><code>@Entity
class Book(@field:ColumnInfo(name = &quot;book_name&quot;)
           var bookName: String?, var author: String?, var type: String?) {

    @PrimaryKey(autoGenerate = true)
    var id: Int = 0
}
</code></pre><p><strong>Book</strong> æœ‰ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«è¡¨ç¤ºä¹¦åã€ä½œè€…ã€ç±»å‹ã€‚å…¶ä¸­æœ‰ä¸‰ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>æ¯ä¸ª <strong>Entityå¯¹è±¡</strong> éƒ½éœ€è¦ä½¿ç”¨ <strong>@Entity</strong> æ³¨é‡Šå£°æ˜</li>
<li><strong>@PrimaryKey</strong> æ³¨é‡Šç”¨äºå£°æ˜ä¸»é”®ï¼Œè¿™é‡Œè¿˜æ·»åŠ äº† autoGenerate = trueï¼Œè¡¨ç¤ºå®ƒæ˜¯è‡ªå¢çš„</li>
<li><strong>@ColumnInfo</strong> æ³¨é‡Šç”¨æ¥ç»™å±æ€§è®¾ç½®åˆ«åï¼Œå¦‚æœ <strong>bookName</strong> å±æ€§ä¸è®¾ç½®åˆ«åçš„è¯ï¼ŒæŸ¥è¯¢çš„æ—¶å€™å¯ä»¥é€šè¿‡ â€œ<strong>bookName</strong>â€è¿›è¡ŒæŸ¥è¯¢ï¼Œè®¾ç½®åˆ«ååå°±å¯ä»¥é€šè¿‡è®¾ç½®çš„â€œ<strong>book_name</strong>â€ è¿›è¡ŒæŸ¥è¯¢äº†ï¼Œçœ‹ <strong>DAOæ¥å£</strong> ä¾¿çŸ¥</li>
</ul>
<h3 id="åˆ›å»º-DAO"><a href="#åˆ›å»º-DAO" class="headerlink" title="åˆ›å»º DAO"></a>åˆ›å»º DAO</h3><p>è¿™é‡Œï¼Œé€šè¿‡ <strong>DAOæ¥å£</strong> æ¥å¯¹ <strong>Book</strong> è¿™ä¸ªå¯¹è±¡è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼š</p>
<pre><code>@Dao
interface BookDao {

    @get:Query(&quot;SELECT * FROM book&quot;)
    val all: List&lt;Book&gt;

    @Query(&quot;SELECT * FROM book WHERE author LIKE :author&quot;)
    fun getBookByAuthor(author: String): List&lt;Book&gt;

    @Query(&quot;SELECT * FROM book WHERE book_name LIKE :name&quot;)
    fun getBookByNamer(name: String): List&lt;Book&gt;

    @Insert
    fun insert(book: Book): Long?

    @Insert
    fun insert(vararg books: Book): List&lt;Long&gt;

    @Insert
    fun insert(books: List&lt;Book&gt;): List&lt;Long&gt;

    @Update
    fun update(book: Book): Int

    @Update
    fun update(vararg books: Book): Int

    @Update
    fun update(books: List&lt;Book&gt;): Int

    @Delete
    fun delete(book: Book): Int

    @Delete
    fun delete(vararg books: Book): Int

    @Delete
    fun delete(books: List&lt;Book&gt;): Int

}
</code></pre><p>ä¸Šé¢çš„ <strong>DAOæ¥å£</strong>ï¼ŒåŒæ ·éœ€è¦è¿›è¡Œå‡ ç‚¹è¯´æ˜ï¼š</p>
<ul>
<li><strong>DAOæ¥å£</strong> éœ€è¦ä½¿ç”¨ <strong>@Dao</strong> æ³¨é‡Šè¿›è¡Œå£°æ˜</li>
<li><strong>Insert</strong> æ“ä½œå¯ä»¥ä½¿ç”¨ <strong>Long</strong> ä½œä¸ºè¿”å›å€¼çš„ç±»å‹ï¼Œè¡¨ç¤ºæ’å…¥æ“ä½œå‰çš„å¯¹è±¡æ•°é‡</li>
<li><strong>Update</strong> å’Œ <strong>Delete</strong> æ“ä½œå¯ä»¥ä½¿ç”¨ Int ä½œä¸ºè¿”å›å€¼ï¼Œè¡¨ç¤ºæ›´æ–°æˆ–è€…åˆ é™¤çš„è¡Œæ•°</li>
<li>è¿”å›ç±»å‹è¿˜å¯ä»¥æ˜¯ <strong>void</strong> ï¼Œå¦‚æœç»“åˆ <strong>Rxjava</strong> ä½¿ç”¨çš„è¯è¿˜å¯ä»¥æ˜¯ <strong>Completableã€Singleã€ Maybeã€Flowable</strong>ç­‰ï¼Œå…·ä½“å¯ä»¥å‚è§è¿™ç¯‡æ–‡ç« ï¼š<a href="https://medium.com/androiddevelopers/room-rxjava-acb0cd4f3757" target="_blank" rel="noopener">Room ğŸ”— RxJava</a>(éœ€è¦å¤‡å¥½æ¢¯å­ï¼Œä¸è¿‡åç»­æœ‰æ—¶é—´çš„è¯æˆ‘ä¹Ÿä¼šä»‹ç»ä¸€ä¸‹Roomæ­é…Rxjavaçš„ä½¿ç”¨)</li>
</ul>
<p><strong>Daoæ¥å£</strong> ç¼–å†™å®Œæˆåï¼Œè¿˜å‰©ä¸‹æœ€é‡è¦çš„ <strong>DataBase</strong></p>
<h3 id="åˆ›å»º-DataBase"><a href="#åˆ›å»º-DataBase" class="headerlink" title="åˆ›å»º DataBase"></a>åˆ›å»º DataBase</h3><blockquote>
<p>ç”±äºå®ä¾‹åŒ–ä¸€ä¸ª <strong>RoomDatabase</strong> å¯¹è±¡çš„å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæ‰€ä»¥ <strong>DataBase</strong> çš„ä½¿ç”¨éœ€è¦éµå¾ªå•ä¾‹æ¨¡å¼ï¼Œåªåœ¨å…¨å±€åˆ›å»ºä¸€ä¸ªå®ä¾‹å³å¯ã€‚</p>
</blockquote>
<p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œè¿˜æ˜¯ä½¿ç”¨javaä»£ç å»åˆ›å»ºä¸€ä¸ª <strong>BookDataBaseç±»</strong>ï¼Œå½“ç„¶ï¼Œè½¬æ¢æˆKotlinåªéœ€è¦Shift + Alt + Ctrl + K å³å¯</p>
<p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯é¥¿æ±‰å¼çš„å•ä¾‹æ¨¡å¼ï¼Œåœ¨Kotlinä¸­é€šè¿‡objectä¿®é¥°å¯è¾¾åˆ°åŒæ ·æ•ˆæœ</p>
<pre><code>@Database(entities = {Book.class}, version = 1)
public abstract class BookDataBase extends RoomDatabase {
    public abstract BookDao bookDao();
    private static BookDataBase instance;

    public static BookDataBase getInstance(Context context){
        if (instance == null){
            synchronized (BookDataBase.class){
                if (instance == null){
                    instance = create(context);
                }
            }
        }
        return instance;
    }

    private static BookDataBase create(Context context) {
        return Room.databaseBuilder( context,BookDataBase.class,&quot;book-db&quot;).allowMainThreadQueries().build();
    }
}
</code></pre><p>ä¸Šé¢çš„ä¾‹å­ä¸­æœ‰ä¸€äº›éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š</p>
<ul>
<li><strong>@Database</strong> æ³¨é‡Šç”¨äºè¿›è¡Œå£°æ˜ï¼ŒåŒæ—¶è¿˜éœ€è¦æœ‰ç›¸å…³çš„ <strong>entityå¯¹è±¡</strong>ï¼Œå…¶ä¸­ <strong>version</strong> æ˜¯å½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœä½ å¯¹æ•°æ®ç›¸å…³çš„<strong>å®ä½“ç±»ç»“æ„</strong>è¿›è¡Œäº†æ›´æ”¹ï¼Œè¿™é‡Œçš„ <strong>version</strong> å°±éœ€è¦<strong>åŠ ä¸€</strong></li>
<li><strong>BookDataBase</strong> é™¤äº†ç»§æ‰¿äº <strong>RoomDatabase</strong> ï¼Œè¿˜éœ€è¦å®ä¾‹å‡ºç›¸å…³çš„ <strong>DAOæ¥å£</strong></li>
<li>create()æ–¹æ³•ä¸­çš„â€<strong>book-db</strong>â€œæ˜¯æ•°æ®åº“çš„åå­—ï¼Œè¿™é‡Œéšæ„ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ <strong>allowMainThreadQueries()</strong> æ–¹æ³•ï¼Œè¿™é‡Œç”±äºæˆ‘ä»¬ä¼šç”¨åˆ°å•å…ƒæµ‹è¯•ï¼Œæ‰€ä»¥åŠ ä¸Šè¿™è¡Œä»£ç æ˜¯ä¸ºäº†é˜²æ­¢ ã€<em>Cannot access database on the main thread since it may potentially lock the UI for a long period of time.</em>ã€‘ çš„æŠ¥é”™ã€‚æ­£å¼ä½¿ç”¨æ—¶ï¼Œè¯·åŠ¡å¿…å»æ‰è¿™è¡Œä»£ç ï¼Œå› ä¸ºå®ƒä¼šè®©æ‰€æœ‰è€—æ—¶æ“ä½œè¿è¡Œåœ¨ä¸»çº¿ç¨‹ï¼</li>
</ul>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥å…ˆæ„‰å¿«çš„è¿›è¡Œæµ‹è¯•äº†.</p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="åˆçº§æµ‹è¯•"><a href="#åˆçº§æµ‹è¯•" class="headerlink" title="åˆçº§æµ‹è¯•"></a>åˆçº§æµ‹è¯•</h3><p>æ‰¾åˆ° <strong>src</strong> ä¸‹çš„ <strong>test</strong> ç›®å½•ï¼Œç„¶åå¯ä»¥åƒæˆ‘è¿™æ ·åˆ›å»ºä¸€ä¸ª <strong>RoomTest</strong> ç±»è¿›è¡Œæµ‹è¯•</p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/010.png" alt="image"></p>
<p>è¯´åˆ°è¿™é‡Œï¼Œå¯èƒ½ä¼šæœ‰ç«¥é‹å°šæœªäº†è§£è¿‡å•å…ƒæµ‹è¯•ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥å…ˆå»çœ‹çœ‹ç›¸å…³åšå®¢ï¼Œæ¯”å¦‚è¿™ç¯‡</p>
<p><a href="https://juejin.im/post/5b57e3fbf265da0f47352618" target="_blank" rel="noopener">Android å•å…ƒæµ‹è¯•åªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></p>
<p>ä¸è¿‡è¿™é‡Œä½¿ç”¨çš„å•å…ƒæµ‹è¯•æ˜¯ Android Studio è‡ªå¸¦çš„ï¼Œä¹Ÿæ²¡æœ‰ç”¨åˆ°å¤ªå¤æ‚çš„ä¸œè¥¿ï¼ŒåŒæ—¶æˆ‘ä¼šåšä¸€äº›è¯´æ˜ï¼Œä¸å¤Ÿäº†è§£çš„ç«¥é‹ä¹Ÿå¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ï¼Œçœ‹å®Œä½ ä¹Ÿå°±äº†è§£äº†</p>
<pre><code>@RunWith(AndroidJUnit4::class)
class RoomTest {

    private var bookDao: BookDao? = null
    private var bookDataBase: BookDataBase? = null

    @Before
    @Throws(Exception::class)
    fun setUp() {
        ShadowLog.stream = System.out      //è¿™æ ·æ–¹ä¾¿æ‰“å°æ—¥å¿—
        val context = InstrumentationRegistry.getTargetContext()
        bookDataBase = BookDataBase.getInstance(context)
        bookDao = bookDataBase!!.bookDao()
    }


    @Test
    fun insert() {
        val book1 = Book(&quot;æ—¶é—´ç®€å²&quot;, &quot;æ–¯è’‚èŠ¬Â·å¨å»‰Â·éœé‡‘&quot;, &quot;ç§‘å­¦&quot;)
        val book2 = Book(&quot;ç™¾å¹´å­¤ç‹¬&quot;, &quot;è¥¿äºšÂ·é©¬å°”å…‹æ–¯&quot;, &quot;æ–‡å­¦&quot;)
        val list = bookDao!!.insert(book1, book2)

        assert(list.size == 2)
    }

    @Test
    fun query(){
        val books = bookDao!!.all
        for (book in books) {
            Log.e(javaClass.name, &quot;è·å–çš„ä¹¦ç±æ•°æ®: ${Gson().toJson(book)}&quot;)
        }
    }

    @After
    @Throws(Exception::class)
    fun cloaseDb() {
        bookDataBase?.close()
    }
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„å•å…ƒæµ‹è¯•ä½¿ç”¨çš„æ˜¯ <strong>AndroidJUnit4</strong>ï¼Œé€šè¿‡ <strong>@Before</strong> æ³¨é‡Šçš„æ–¹æ³•ï¼Œè¡¨ç¤ºç”¨äº<strong>ç›¸å…³èµ„æºçš„åˆå§‹åŒ–</strong>ï¼Œç±»ä¼¼äºActivityçš„onCreate()æ–¹æ³•ï¼›è€Œé€šè¿‡ <strong>@After</strong> æ³¨é‡Šçš„æ–¹æ³•ï¼Œåˆ™æ˜¯ç”¨äº<strong>ç›¸å…³èµ„æºçš„é”€æ¯</strong>ï¼Œç±»ä¼¼äºActivityçš„onDestroy()æ–¹æ³•ã€‚</p>
<p>å‰©ä¸‹çš„ï¼Œé€šè¿‡ <strong>@Test</strong> æ³¨é‡Šçš„æ–¹æ³•å°±è¡¨ç¤ºç”¨äºæµ‹è¯•çš„å•å…ƒï¼Œæ¯ä¸ªæµ‹è¯•ç±»é‡Œé¢å¯ä»¥æœ‰å¤šä¸ªæµ‹è¯•å•å…ƒï¼Œè¿™é‡Œç›®å‰åªå†™äº†æ’å…¥å’ŒæŸ¥è¯¢ä¸¤ä¸ªå•å…ƒï¼Œåœ¨ <strong>RoomTest</strong> ç±»ä¸Šé€šè¿‡å³é”®è¿è¡Œï¼Œç„¶åçœ‹ä¸€ä¸‹ç»“æœï¼š<br><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/011.png" alt="image"></p>
<p>åœ¨æµ‹è¯•ä»£ç ä¸­çš„ <strong>insert()å•å…ƒ </strong> é‡Œï¼Œæœ‰è¿™æ ·ä¸€è¡Œä»£ç ï¼š</p>
<pre><code>assert(list.size == 2)
</code></pre><p>è€Œæµ‹è¯•çš„ç»“æœæ˜¯ä¸€ç‰‡ç»¿è‰²ï¼Œå°±è¡¨ç¤ºè¿™ä¸ªæ–­è¨€æ˜¯æ­£ç¡®çš„ï¼Œliståˆ—è¡¨é•¿åº¦åˆšå¥½ä¸º2ï¼Œè¿™é‡Œä¸ºäº†éªŒè¯è¿”å›çš„listæ˜¯æ•´ä¸ªæ•°æ®åº“é•¿åº¦è¿˜æ˜¯ä»…ä»…è¡¨ç¤ºæ­¤æ¬¡è¿›è¡Œæ’å…¥æ“ä½œçš„é•¿åº¦ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ insert()æµ‹è¯•å•å…ƒï¼š</p>
<pre><code>   @Test
    fun insert() {
        val book1 = Book(&quot;æ—¶é—´ç®€å²&quot;, &quot;æ–¯è’‚èŠ¬Â·å¨å»‰Â·éœé‡‘&quot;, &quot;ç§‘å­¦&quot;)
        val book2 = Book(&quot;ç™¾å¹´å­¤ç‹¬&quot;, &quot;è¥¿äºšÂ·é©¬å°”å…‹æ–¯&quot;, &quot;æ–‡å­¦&quot;)
        val list = bookDao!!.insert(book1, book2)
        assert(list.size == 2)

        val list2 = bookDao!!.insert(book1, book2)
        assert(list2.size == 4)
    }
</code></pre><p>è¿™æ—¶å€™åœ¨ <strong>insert()å•å…ƒæµ‹è¯•åŒºåŸŸ</strong> å³é”®è¿è¡Œï¼Œå°±åªæµ‹è¯•è¿™ä¸€ä¸ªå•å…ƒï¼Œç„¶åç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/012.png" alt="image"></p>
<p>æˆ‘ä»¬åœ¨ insert()å•å…ƒ ä¸­è¿›è¡Œäº†ä¸¤æ¬¡æ’å…¥æ“ä½œï¼Œæ‰€ä»¥æ•°æ®åº“çš„æ€»é•¿åº¦åº”è¯¥ä¸º 4 ï¼Œè€Œè¿™é‡Œç¬¬39è¡Œçš„ä»£ç ï¼š</p>
<pre><code>assert(list2.size == 4)
</code></pre><p>è¿”å›çš„cede æ˜¯ -1ï¼Œå°±è¡¨ç¤ºå®é™…ä¸Šæ¯æ¬¡æ’å…¥æ“ä½œè¿”å›çš„åˆ—è¡¨é•¿åº¦åº”è¯¥ä¸ºæ’å…¥çš„æ•°é‡ï¼Œè€Œéæ•°æ®åº“æ€»é‡ã€‚å…¶ä»–æ“ä½œäº¦æ˜¯å¦‚æ­¤ã€‚</p>
<p>åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬çš„æµ‹è¯•å¹¶ä¸èƒ½ç›´æ¥ç”¨äºæ­£å¼çš„é¡¹ç›®ä¸­ï¼Œå› ä¸ºæ•°æ®åº“æ“ä½œå±äºè€—æ—¶æ“ä½œï¼Œæ‰€ä»¥ä¸€å®šä¸èƒ½æŠŠè¿™äº›æ“ä½œæ”¾åœ¨ä¸»çº¿ç¨‹é‡Œï¼Œè€Œæœ€æ–¹ä¾¿çš„çº¿ç¨‹åˆ‡æ¢ï¼Œè«è¿‡äº <strong>Rxjava</strong> å•¦ï¼</p>
<p>ç°åœ¨å¼€å§‹ä½¿ç”¨ <strong>Rxjava</strong> è¿›è¡Œæµ‹è¯•å§</p>
<h3 id="ç»“åˆRxjavaçš„æµ‹è¯•"><a href="#ç»“åˆRxjavaçš„æµ‹è¯•" class="headerlink" title="ç»“åˆRxjavaçš„æµ‹è¯•"></a>ç»“åˆRxjavaçš„æµ‹è¯•</h3><p>é¦–å…ˆï¼Œè¦åœ¨é¡¹ç›®ä¸­æ·»åŠ  <strong>Rxjava</strong> çš„ä¾èµ–ï¼š</p>
<pre><code>    //rxJava2+rxAndroid
    implementation &quot;io.reactivex.rxjava2:rxjava:2.x.y&quot;
    implementation &#39;io.reactivex.rxjava2:rxandroid:2.1.0&#39;
</code></pre><p>åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼ŒRxJava å¦‚æœåš <strong>IOçº¿ç¨‹</strong> åˆ° <strong>UIçº¿ç¨‹</strong> çš„åˆ‡æ¢æ“ä½œï¼Œç»“æœæ˜¯æ— æ³•è·å–çš„ï¼Œæ‰€ä»¥éœ€è¦å°†è¿™äº›çº¿ç¨‹è¿›è¡Œåˆå¹¶ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code>    @Before
    @Throws(Exception::class)
    fun setUp() {
        val context = InstrumentationRegistry.getTargetContext()
        bookDataBase = BookDataBase.getInstance(context)
        bookDao = bookDataBase!!.bookDao()
        ShadowLog.stream = System.out

        initRxJava2()
    }

    private fun initRxJava2() {
        RxJavaPlugins.reset()
        RxJavaPlugins.setIoSchedulerHandler { Schedulers.trampoline() }
        RxAndroidPlugins.reset()
        RxAndroidPlugins.setMainThreadSchedulerHandler { Schedulers.trampoline() }
    }
</code></pre><p>åœ¨ <strong>@Beforeæ³¨è§£</strong> ä¸‹çš„ <strong>setUp()</strong> æ–¹æ³•ä¸­è¿›è¡ŒRxJavaçš„é…ç½®ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æŠŠRxJavaå¸¸ç”¨çš„çº¿ç¨‹åˆ‡æ¢å†™åœ¨ä¸€ä¸ªæ–¹æ³•é‡Œï¼Œæ–¹ä¾¿å¤ç”¨ï¼š</p>
<pre><code>    private fun&lt;T&gt; doWithRxJava(t: T): Observable&lt;T&gt;{
        return Observable.create&lt;T&gt;{it.onNext(t)}
                .subscribeOn(Schedulers.io())
                .unsubscribeOn(Schedulers.io())
                .observeOn(AndroidSchedulers.mainThread())
    }
</code></pre><p>æ¥ç€ï¼Œå¯¹ <strong>insertå•å…ƒ</strong> å’Œ <strong>queryå•å…ƒ</strong> è¿›è¡Œä¿®æ”¹ï¼š</p>
<pre><code>    @Test
    fun insert() {
        val book1 = Book(&quot;æ—¶é—´ç®€å²&quot;, &quot;æ–¯è’‚èŠ¬Â·å¨å»‰Â·éœé‡‘&quot;, &quot;ç§‘å­¦&quot;)
        val book2 = Book(&quot;ç™¾å¹´å­¤ç‹¬&quot;, &quot;è¥¿äºšÂ·é©¬å°”å…‹æ–¯&quot;, &quot;æ–‡å­¦&quot;)
        doWithRxJava(bookDao!!.insert(book1, book2))
                .subscribe ({
                    Log.e(&quot;inserté•¿åº¦ï¼š&quot; , &quot;${it.size}&quot;)
                    assert(it.size == 2)
                },{
                    Log.e(&quot;insertå‡ºé”™ï¼š&quot; , &quot;${it.stackTrace}-${it.message}&quot;)
                })
    }

    @Test
    fun query(){
        doWithRxJava(bookDao?.all)
                .subscribe({
                    for(book in it?: emptyList()){
                        Log.e(javaClass.name, &quot;è·å–çš„ä¹¦ç±æ•°æ®: ${Gson().toJson(book)}&quot;)
                        assert(it?.size == 2)
                    }
                },{
                    Log.e(&quot;queryå‡ºé”™ï¼š&quot; , &quot;${it.stackTrace}-${it.message}&quot;)
                })
    }
</code></pre><p>ç„¶åçœ‹ä¸€ä¸‹æµ‹è¯•çš„ç»“æœï¼š</p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/013.png" alt="image"></p>
<p>é‚£ä¹ˆï¼Œ <strong>Room DataBase</strong> çš„å…¥é—¨æŒ‡å—ï¼Œå°±å†™åˆ°è¿™é‡Œå•¦ï¼</p>
<p>åç»­æˆ‘å¯èƒ½ä¼šå†å†™ä¸€ç¯‡è¿›é˜¶ç‰ˆçš„æ–‡ç« ï¼Œæ¶µç›–äº†çœŸå®ä½¿ç”¨çš„åœºæ™¯ï¼Œç„¶åçœ‹èƒ½ä¸èƒ½å†™ä¸€ä¸ªç®€å•çš„Demoå‡ºæ¥ï¼Œè¿™æ ·æ›´æ–¹ä¾¿å­¦ä¹ å§ï¼</p>
<p><del><em>ä¸è¿‡æˆ‘å‘ç°æˆ‘ç°åœ¨çš„æ‡’ç™Œæ˜¯è¶Šæ¥è¶Šä¸¥é‡äº†ï¼Œä¹Ÿä¸çŸ¥é“ä¸‹ä¸€ç¯‡æ˜¯ä»€ä¹ˆæ—¶å€™</em></del></p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/Room-Database/014.png" alt="image"></p>

                            <hr>
                        </div>
                        <br>
                        <div>
                            
                            <p>
                                <i class="iconfont icon-tag"></i>
                                
                                    <a class="hover-with-bg" href="/tags/Android">Android</a>
                                
                            </p>
                            
                                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0åè®®</a> ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
                            
                        </div>
                    </div>
                </div>
            </div>
        <div class="d-none d-lg-block col-lg-2 toc-container">
            
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;ç›®å½•</p> 
    <div id="tocbot"></div>
  </div>

        </div>
    </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
    <div class="container comments mx-auto" id="comments">
        
    </div>
</div>

    
</main>


    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>


<footer class="mt-5">
    <div class="text-center py-3">
        <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
        <i class="iconfont icon-love"></i>
        <a href="https://github.com/0x2e/Material-T" target="_blank" rel="nofollow noopener"> <b>Material-T</b></a>
        <br>
        
    </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/mdbootstrap/js/jquery-3.4.1.min.js"></script>
<script src="/lib/mdbootstrap/js/popper.min.js"></script>
<script src="/lib/mdbootstrap/js/bootstrap.min.js?v=4.3.1"></script>
<script src="/lib/mdbootstrap/js/mdb.min.js?v=4.8.7"></script>
<script src="/lib/nprogress/nprogress.min.js?v=0.2.0"></script>
<script src="/js/main.js"></script>

    
        <script src="/lib/tocbot/tocbot.min.js?v=4.7.0"></script>
    
    <script src="/js/post.js"></script>


    <script src="/lib/prettify/prettify.min.js?v=0.1.0"></script>
    <script>
        $(document).ready(function () {
            $('pre').addClass('prettyprint linenums');
            prettyPrint();
        })
    </script>


    <script src="/lib/typed/typed.min.js?v=2.0.9"></script>
    <script>
        var typed = new Typed('#subtitle', {
            strings: [
                '  ',
                "Room Databaseå…¥é—¨æŒ‡å—&nbsp;",
            ],
            cursorChar: "_",
            typeSpeed: 70,
            loop: false,
        });
        typed.stop();
        $(document).ready(function () {
            $(".typed-cursor").addClass("h2");
            typed.start();
        });
    </script>


    <script src="/lib/anchor/anchor.min.js?v=4.2.0"></script>
    <script>
        anchors.options = {
            placement: "right",
            visible: "false",
            
        };
        var el = "h1,h2,h3,h4,h5,h6".split(",")
        var res = []
        for (item of el) {
            res.push(".markdown-body > " + item)
        }
        anchors.add(res.join(", "))
    </script>



    <script src="/js/local-search.js"></script>
    <script>
        var path = "/local-search.xml";
        var inputArea = document.querySelector("#local-search-input");
        inputArea.onclick = function () {
            getSearchFile(path);
            this.onclick = null
        }
    </script>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":75,"height":150},"mobile":{"show":true},"log":false});</script></body>
</html>