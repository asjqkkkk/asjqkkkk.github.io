<!DOCTYPE html>
<html lang="zh-Hans">





<head>
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/img/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="知惑顿断如碎石，思惑难断如藕丝">
    <meta name="author" content="Old Chen">
    <meta name="keywords" content="Android">
    <title>DataBinding——从相识到相知（二）：互酌 ~ 老晨子の博客</title>
    <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css?v=5.7.2">
    <link rel="stylesheet" href="/lib/mdbootstrap/css/bootstrap.min.css?v=4.3.1">
    <link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css?v=4.8.7">
    <link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css">
    <link rel="stylesheet" href="/lib/nprogress/nprogress.css?v=0.2.0">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">
    
        <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css">
    
    <link rel="stylesheet" href="/css/main.css">

    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?31ba4ee985b9a41c9b5fa8e7ac95916a";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

</head>


<body>
<header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
<div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>老晨子の博客</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto text-center">
            
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/archives/">Archives</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/categories/">Categories</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/tags/">Tags</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/about/">About</a>
            </li>
            
            
                <li class="nav-item" id="search-btn">
                    <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
                </li>
            
        </ul>
    </div>
</div>


</nav>
    <div class="view intro-2"
         style="background: url('/img/post.png')no-repeat center center;background-size: cover;">
        <div class="full-bg-img">
            <div class="mask rgba-black-light flex-center">
                <div class="container text-center white-text wow fadeInUp">
                    <span class="h2" id="subtitle">
                        
                    </span>
                    
                        <br>
                        <p>Saturday, October 20th 2018, 12:55 pm</p>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<main>
    
        

<div class="container-fluid">
    <div class="row">
        <div class="d-none d-lg-block col-lg-2"></div>
            <div class="col-lg-8 nopadding-md">
                <div class="py-5 z-depth-3 board">
                    <div class="post-content mx-auto">
                        <div class="markdown-body">
                            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>上一篇里，主要讲了关于Databinding的以下几点：</p>
<ul>
<li>接入与使用</li>
<li>简单的数据绑定</li>
<li>点击事件的绑定</li>
</ul>
<p>这一篇将会继续上一篇的步伐，对DataBinding的使用更深几分.首先依旧是从数据绑定开始<br><a id="more"></a> </p>
<blockquote>
<p>之前所介绍的，虽然UI与数据进行了绑定，但是修改数据对象的时候并不会同时更新 <strong>UI</strong> .<br>现在有三种不同类型的 <strong>observable</strong> 类：<strong>objects</strong>, <strong>fields</strong>, 还有 <strong>collections</strong>.<br>当其中某个 <strong>observable</strong> 数据对象绑定到 <strong>UI</strong> 并且数据对象的属性发生更改时， UI 将自动更新，下面开始介绍.</p>
</blockquote>
<h1 id="Observable数据"><a href="#Observable数据" class="headerlink" title="Observable数据"></a>Observable数据</h1><p>如果你的数据类只有几个属性，那么没必要去实现 <strong>Observable</strong> 接口来监听数据的改变，可以使用下面这些字段：</p>
<ul>
<li><a href="https://developer.android.google.cn/reference/android/databinding/ObservableBoolean.html" target="_blank" rel="noopener"><strong>ObservableBoolean</strong></a></li>
<li><a href="https://developer.android.google.cn/reference/android/databinding/ObservableByte.html" target="_blank" rel="noopener"><strong>ObservableByte</strong></a></li>
<li><a href="https://developer.android.google.cn/reference/android/databinding/ObservableChar.html" target="_blank" rel="noopener"><strong>ObservableChar</strong></a></li>
<li><a href="https://developer.android.google.cn/reference/android/databinding/ObservableShort.html" target="_blank" rel="noopener"><strong>ObservableShort</strong></a></li>
<li><a href="https://developer.android.google.cn/reference/android/databinding/ObservableInt.html" target="_blank" rel="noopener"><strong>ObservableInt</strong></a></li>
<li><a href="https://developer.android.google.cn/reference/android/databinding/ObservableLong.html" target="_blank" rel="noopener"><strong>ObservableLong</strong></a></li>
<li><a href="https://developer.android.google.cn/reference/android/databinding/ObservableFloat.html" target="_blank" rel="noopener"><strong>ObservableFloat</strong></a></li>
<li><a href="https://developer.android.google.cn/reference/android/databinding/ObservableDouble.html" target="_blank" rel="noopener"><strong>ObservableDouble</strong></a></li>
<li><a href="https://developer.android.google.cn/reference/android/databinding/ObservableParcelable.html" target="_blank" rel="noopener"><strong>ObservableParcelable</strong></a></li>
</ul>
<p>现在，我们再创建一个类</p>
<pre><code>class ObservableBean {
    val text = ObservableField&lt;String&gt;()
}
</code></pre><p>布局文件改为：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;layout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
    &lt;data&gt;
        &lt;variable name=&quot;model&quot; type=&quot;com.test.project.testdatabinding.MVP.DataBinding.Bean.ObservableBean&quot;/&gt;
    &lt;/data&gt;

    &lt;LinearLayout
        android:orientation=&quot;vertical&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;&gt;

        &lt;EditText
            android:id=&quot;@+id/et_test&quot;
            android:text=&quot;@={model.text}&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;

        &lt;TextView
            android:id=&quot;@+id/tv_test&quot;
            android:text=&quot;@{model.text}&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;/&gt;

    &lt;/LinearLayout&gt;
&lt;/layout&gt;
</code></pre><p>需要注意的是，上面的 <strong>EditText</strong> 的 <strong>text</strong> 属性使用的是 <strong>@={}</strong> 而 <strong>TextView</strong> 使用的是 <strong>@{}</strong> 。当你想要使用双向绑定的时候，可别忘了这个 <strong>=</strong> 号</p>
<p>Activity的代码只改变了绑定对象：</p>
<pre><code>class DataBindingActivity&lt;T&gt; : AppCompatActivity() {


    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
//        setContentView(R.layout.activity_data_binding)
        val bindingBinding : ActivityDataBindingBinding = DataBindingUtil.setContentView(this, R.layout.activity_data_binding)
        bindingBinding.model = ObservableBean()
    }
}
</code></pre><p>效果如下：</p>
<p><img src="https://blog-pic-1256696029.cos.ap-guangzhou.myqcloud.com/DataBinding/two/databinding-001.gif" alt="image"></p>
<p>可以看到，直接使用 <strong>Observable</strong> 字段去实现双向数据绑定是很轻松的，不过实际项目里面需求各不相同，要将数据都换成 <strong>Observable</strong> 字段还是很麻烦的，所以自定义双向数据绑定非常有必要！</p>
<p>这时对 <strong>ObservableBean</strong> 进行修改：</p>
<pre><code>class ObservableBean : BaseObservable() {
    @get:Bindable
    var text: String = &quot;&quot;
    set(value) {
        field = value
        notifyPropertyChanged(BR.text)
    }
}

//相较于Kotlin写法，这里我觉得Java写法更有助于理解：
public  class ObservableBean extends BaseObservable {
    private String text;

    @Bindable
    public String getText() {
        return text;
    }

    public ObservableBean setText(String text) {
        this.text = text;
        notifyPropertyChanged(BR.text);
        return this;
    }
}

</code></pre><p>修改过后的效果与之前使用 <strong>Observable</strong> 字段的效果一样，上面需要注意的两点：</p>
<ul>
<li>使用了 <strong>@Bindable</strong> 注解，进行绑定声明</li>
<li>使用了 <strong>notifyPropertyChanged()</strong> 方法为数据刷新做准备</li>
</ul>
<p>不过在我看来，通过这种继承的方法对于我们原有的数据结构并不过友好，尤其是继承了 <strong>BaseObservable</strong> 类的数据类不能通过  <strong>Gson</strong> 去与 <strong>Json</strong> 相互转换。</p>
<p>所以使用的时候，我们可以考虑通过某个中介类的方式去进行转换.</p>
<h1 id="布局的绑定"><a href="#布局的绑定" class="headerlink" title="布局的绑定"></a>布局的绑定</h1><p>第第一篇中，有写到Activity中如何获取自动生成的布局绑定类——xxxBinding，这种类的命名与使用数据绑定的布局文件xml有关，比如说 <strong>activity_main.xml</strong> 就会生成 <strong>ActivityMainBinding</strong> </p>
<p>这里再详细说明一下，不同类型的布局，应该怎么获取生成的 <strong>Binding绑定类</strong> </p>
<blockquote>
<p>事先并不知道绑定类型的对象可以使用 <strong>DataBindingUtil</strong> 去创建绑定</p>
</blockquote>
<pre><code>val rootView = LayoutInflater.from(this).inflate(layoutId, parent, attachToParent)
val binding: ViewDataBinding? = DataBindingUtil.bind(viewRoot)
</code></pre><h2 id="获取带-ID-的-View对象"><a href="#获取带-ID-的-View对象" class="headerlink" title="获取带 ID 的 View对象"></a>获取带 ID 的 View对象</h2><p>如果使用的是Kotlin，可以直接在Activity里很方便的使用id获取View对象，不过使用DataBinding后，就有另外一种获取View对象的方式了</p>
<p>布局里面的 Id 如下：</p>
<pre><code>    ...
        &lt;EditText
            android:id=&quot;@+id/et_test&quot;
            android:text=&quot;@={model.text}&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;

    ...
</code></pre><p>通过 Id 获取 EditText 的方法如下：</p>
<pre><code>        ...
        super.onCreate(savedInstanceState)
        val bindingBinding : ActivityDataBindingBinding = DataBindingUtil.setContentView(this, R.layout.activity_data_binding)
        bindingBinding.model = ObservableBean()
        val editText = bindingBinding.root.rootView.findViewById&lt;EditText&gt;(R.id.et_test)
</code></pre><blockquote>
<p><strong>立即绑定</strong>  </p>
<p>当变量或可观察对象发生更改时，绑定会在下一帧之前更改。 不过有的时候需要立刻执行绑定.  </p>
<p>若要强制执行，可以使用 <strong>executePendingBindings()</strong> 方法。</p>
</blockquote>
<h2 id="高级绑定"><a href="#高级绑定" class="headerlink" title="高级绑定"></a>高级绑定</h2><p>有时候，特定的绑定类是未知的.  </p>
<p>例如，针对任意布局操作的 <strong>RecyclerView.Adapter</strong> 不知道特定的绑定类.它仍然必须在调用 <strong>onBindViewHolder()</strong> 方法时分配绑定值.</p>
<p>在 <strong>RecyclerView</strong> 的  <strong>onBindViewHolder()</strong> 方法里，可以这样写：</p>
<pre><code>override fun onBindViewHolder(holder: BindingHolder, position: Int) {
    item: T = mItems.get(position)
    holder.binding.setVariable(BR.item, item);
    holder.binding.executePendingBindings();
}
</code></pre><h2 id="使用-BindingAdapter自定义绑定逻辑"><a href="#使用-BindingAdapter自定义绑定逻辑" class="headerlink" title="使用@BindingAdapter自定义绑定逻辑"></a>使用@BindingAdapter自定义绑定逻辑</h2><p>DataBinding为我们提供了一种可以对绑定逻辑进行自定义的方法，比如说我想在xml中对一个ImageView控件加载图片，并且是使用的Glide加载框架，这时候可以这样：</p>
<pre><code>//随便创建一个类，然后在类中定义如下方法
@BindingAdapter(&quot;imageUrl&quot;)
fun loadImage(view: ImageView, url: String) {
    GlideApp.with(view.getContext())
   .load(url)
   .fitCenter()
   .into(view);
}
</code></pre><p>使用的时候编译器会自动生成对应属性：</p>
<pre><code>&lt;ImageView 
app:imageUrl=&quot;@{model.imageUrl}&quot;  /&gt;
</code></pre><p>使用 <strong>@BindAdapter</strong> 几乎可以完成你想要的各种逻辑，不过我觉得，只有那种使用率特别高的代码，才最适合这个属性.</p>
<h2 id="使用-BindingConversion完成转换功能"><a href="#使用-BindingConversion完成转换功能" class="headerlink" title="使用@BindingConversion完成转换功能"></a>使用@BindingConversion完成转换功能</h2><p>在某些情况下，特定类型之间需要自定义转换。 例如，视图的android:background属性需要Drawable，但指定的颜色值是整数。 </p>
<p>官方例子中，转换功能的具体用法如下：</p>
<pre><code>@BindingConversion
fun convertColorToDrawable(color: Int) = ColorDrawable(color)
</code></pre><p>使用的时候可以这样：</p>
<pre><code>&lt;View
   android:background=&quot;@{isError ? @drawable/error : @color/white}&quot;
   android:layout_width=&quot;wrap_content&quot;
   android:layout_height=&quot;wrap_content&quot;/&gt;
</code></pre><h1 id="暂歇"><a href="#暂歇" class="headerlink" title="暂歇"></a>暂歇</h1><p>本篇关于DataBindin的介绍也就到此结束，不过DataBinding的使用还没有到头，下一篇将会侧重实际上的操作以及DataBinding还可以为我们带来哪些便捷.</p>
<hr>
<h1 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a>未完待续</h1>
                            <hr>
                        </div>
                        <br>
                        <div>
                            
                            <p>
                                <i class="iconfont icon-tag"></i>
                                
                                    <a class="hover-with-bg" href="/tags/Android">Android</a>
                                
                            </p>
                            
                                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
                            
                        </div>
                    </div>
                </div>
            </div>
        <div class="d-none d-lg-block col-lg-2 toc-container">
            
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;TOC</p> 
    <div id="tocbot"></div>
  </div>

        </div>
    </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
    <div class="container comments mx-auto" id="comments">
        
    </div>
</div>

    
</main>


    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>


<footer class="mt-5">
    <div class="text-center py-3">
        <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
        <i class="iconfont icon-love"></i>
        <a href="https://github.com/0x2e/Material-T" target="_blank" rel="nofollow noopener"> <b>Material-T</b></a>
        <br>
        
    </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/mdbootstrap/js/jquery-3.4.1.min.js"></script>
<script src="/lib/mdbootstrap/js/popper.min.js"></script>
<script src="/lib/mdbootstrap/js/bootstrap.min.js?v=4.3.1"></script>
<script src="/lib/mdbootstrap/js/mdb.min.js?v=4.8.7"></script>
<script src="/lib/nprogress/nprogress.min.js?v=0.2.0"></script>
<script src="/js/main.js"></script>

    
        <script src="/lib/tocbot/tocbot.min.js?v=4.7.0"></script>
    
    <script src="/js/post.js"></script>


    <script src="/lib/prettify/prettify.min.js?v=0.1.0"></script>
    <script>
        $(document).ready(function () {
            $('pre').addClass('prettyprint linenums');
            prettyPrint();
        })
    </script>


    <script src="/lib/typed/typed.min.js?v=2.0.9"></script>
    <script>
        var typed = new Typed('#subtitle', {
            strings: [
                '  ',
                "DataBinding——从相识到相知（二）：互酌&nbsp;",
            ],
            cursorChar: "_",
            typeSpeed: 70,
            loop: false,
        });
        typed.stop();
        $(document).ready(function () {
            $(".typed-cursor").addClass("h2");
            typed.start();
        });
    </script>


    <script src="/lib/anchor/anchor.min.js?v=4.2.0"></script>
    <script>
        anchors.options = {
            placement: "right",
            visible: "false",
            
        };
        var el = "h1,h2,h3,h4,h5,h6".split(",")
        var res = []
        for (item of el) {
            res.push(".markdown-body > " + item)
        }
        anchors.add(res.join(", "))
    </script>



    <script src="/js/local-search.js"></script>
    <script>
        var path = "/local-search.xml";
        var inputArea = document.querySelector("#local-search-input");
        inputArea.onclick = function () {
            getSearchFile(path);
            this.onclick = null
        }
    </script>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":75,"height":150},"mobile":{"show":true},"log":false});</script></body>
</html>